#include <dt/geodesic_distance_transform.hpp>
#include <dt/image2d_view.hpp>
#include <dt/transfert.hpp>

#include <gtest/gtest.h>

#include <cstring>

#include "helpers.hpp"

TEST(DistanceTransform, EuclidianFastGeodis)
{
  static constexpr int WIDTH  = 50;
  static constexpr int HEIGHT = 40;

  float ref_data[] = {
      28.284266, 27.870052,  27.45584,  27.041626, 26.627413, 26.213198,  25.798985, 25.384771,  24.970558, 24.556345,
      24.142132, 23.727919,  23.313705, 22.899492, 22.48528,  22.071066,  21.656853, 21.24264,   20.828426, 20.414213,
      20.0,      20.0,       20.0,      20.0,      20.0,      20.0,       20.0,      20.0,       20.0,      20.0,
      20.0,      20.0,       20.0,      20.0,      20.0,      20.0,       20.0,      20.0,       20.0,      20.0,
      20.0,      20.0,       20.0,      20.414213, 20.828426, 21.24264,   21.656853, 22.071066,  22.48528,
      22.899492, //
      27.870052, 26.870052,  26.45584,  26.041626, 25.627413, 25.2132,    24.798985, 24.384771,  23.970558, 23.556345,
      23.142132, 22.727919,  22.313705, 21.899492, 21.48528,  21.071066,  20.656853, 20.24264,   19.828426, 19.414213,
      19.0,      19.0,       19.0,      19.0,      19.0,      19.0,       19.0,      19.0,       19.0,      19.0,
      19.0,      19.0,       19.0,      19.0,      19.0,      19.0,       19.0,      19.0,       19.0,      19.0,
      19.0,      19.0,       19.0,      19.414213, 19.828426, 20.24264,   20.656853, 21.071066,  21.48528,
      21.899492, //
      27.45584,  26.45584,   25.45584,  25.041626, 24.627413, 24.2132,    23.798986, 23.384771,  22.970558, 22.556345,
      22.142132, 21.727919,  21.313705, 20.899492, 20.48528,  20.071066,  19.656853, 19.24264,   18.828426, 18.414213,
      18.0,      18.0,       18.0,      18.0,      18.0,      18.0,       18.0,      18.0,       18.0,      18.0,
      18.0,      18.0,       18.0,      18.0,      18.0,      18.0,       18.0,      18.0,       18.0,      18.0,
      18.0,      18.0,       18.0,      18.414213, 18.828426, 19.24264,   19.656853, 20.071066,  20.48528,
      20.899492, //
      27.041626, 26.041626,  25.041626, 24.041626, 23.627413, 23.2132,    22.798986, 22.384773,  21.970558, 21.556345,
      21.142132, 20.727919,  20.313705, 19.899492, 19.48528,  19.071066,  18.656853, 18.24264,   17.828426, 17.414213,
      17.0,      17.0,       17.0,      17.0,      17.0,      17.0,       17.0,      17.0,       17.0,      17.0,
      17.0,      17.0,       17.0,      17.0,      17.0,      17.0,       17.0,      17.0,       17.0,      17.0,
      17.0,      17.0,       17.0,      17.414213, 17.828426, 18.24264,   18.656853, 19.071066,  19.48528,
      19.899492, //
      26.627413, 25.627413,  24.627413, 23.627413, 22.627413, 22.2132,    21.798986, 21.384773,  20.97056,  20.556345,
      20.142132, 19.727919,  19.313705, 18.899492, 18.48528,  18.071066,  17.656853, 17.24264,   16.828426, 16.414213,
      16.0,      16.0,       16.0,      16.0,      16.0,      16.0,       16.0,      16.0,       16.0,      16.0,
      16.0,      16.0,       16.0,      16.0,      16.0,      16.0,       16.0,      16.0,       16.0,      16.0,
      16.0,      16.0,       16.0,      16.414213, 16.828426, 17.24264,   17.656853, 18.071066,  18.48528,
      18.899492, //
      26.213198, 25.2132,    24.2132,   23.2132,   22.2132,   21.2132,    20.798986, 20.384773,  19.97056,  19.556347,
      19.142132, 18.727919,  18.313705, 17.899492, 17.48528,  17.071066,  16.656853, 16.24264,   15.828426, 15.414213,
      15.0,      15.0,       15.0,      15.0,      15.0,      15.0,       15.0,      15.0,       15.0,      15.0,
      15.0,      15.0,       15.0,      15.0,      15.0,      15.0,       15.0,      15.0,       15.0,      15.0,
      15.0,      15.0,       15.0,      15.414213, 15.828426, 16.24264,   16.656853, 17.071066,  17.48528,
      17.899492, //
      25.798985, 24.798985,  23.798986, 22.798986, 21.798986, 20.798986,  19.798986, 19.384773,  18.97056,  18.556347,
      18.142134, 17.727919,  17.313705, 16.899492, 16.48528,  16.071066,  15.656853, 15.24264,   14.828426, 14.414213,
      14.0,      14.0,       14.0,      14.0,      14.0,      14.0,       14.0,      14.0,       14.0,      14.0,
      14.0,      14.0,       14.0,      14.0,      14.0,      14.0,       14.0,      14.0,       14.0,      14.0,
      14.0,      14.0,       14.0,      14.414213, 14.828426, 15.24264,   15.656853, 16.071066,  16.48528,
      16.899492, //
      25.384771, 24.384771,  23.384771, 22.384773, 21.384773, 20.384773,  19.384773, 18.384773,  17.97056,  17.556347,
      17.142134, 16.72792,   16.313705, 15.899493, 15.485279, 15.071066,  14.656853, 14.24264,   13.828426, 13.414213,
      13.0,      13.0,       13.0,      13.0,      13.0,      13.0,       13.0,      13.0,       13.0,      13.0,
      13.0,      13.0,       13.0,      13.0,      13.0,      13.0,       13.0,      13.0,       13.0,      13.0,
      13.0,      13.0,       13.0,      13.414213, 13.828426, 14.24264,   14.656853, 15.071066,  15.485279,
      15.899493, //
      24.970558, 23.970558,  22.970558, 21.970558, 20.97056,  19.97056,   18.97056,  17.97056,   16.97056,  16.556347,
      16.142134, 15.72792,   15.313706, 14.899493, 14.48528,  14.071066,  13.656853, 13.24264,   12.828426, 12.414213,
      12.0,      12.0,       12.0,      12.0,      12.0,      12.0,       12.0,      12.0,       12.0,      12.0,
      12.0,      12.0,       12.0,      12.0,      12.0,      12.0,       12.0,      12.0,       12.0,      12.0,
      12.0,      12.0,       12.0,      12.414213, 12.828426, 13.24264,   13.656853, 14.071066,  14.48528,
      14.899493, //
      24.556345, 23.556345,  22.556345, 21.556345, 20.556345, 19.556347,  18.556347, 17.556347,  16.556347, 15.556347,
      15.142134, 14.727921,  14.313706, 13.899493, 13.48528,  13.071067,  12.656853, 12.24264,   11.828426, 11.414213,
      11.0,      11.0,       11.0,      11.0,      11.0,      11.0,       11.0,      11.0,       11.0,      11.0,
      11.0,      11.0,       11.0,      11.0,      11.0,      11.0,       11.0,      11.0,       11.0,      11.0,
      11.0,      11.0,       11.0,      11.414213, 11.828426, 12.24264,   12.656853, 13.071067,  13.48528,
      13.899493, //
      24.142132, 23.142132,  22.142132, 21.142132, 20.142132, 19.142132,  18.142134, 17.142134,  16.142134, 15.142134,
      14.142134, 13.727921,  13.313707, 12.899493, 12.48528,  12.071067,  11.656854, 11.24264,   10.828426, 10.414213,
      10.0,      10.0,       10.0,      10.0,      10.0,      10.0,       10.0,      10.0,       10.0,      10.0,
      10.0,      10.0,       10.0,      10.0,      10.0,      10.0,       10.0,      10.0,       10.0,      10.0,
      10.0,      10.0,       10.0,      10.414213, 10.828426, 11.24264,   11.656854, 12.071067,  12.48528,
      12.899493, //
      23.727919, 22.727919,  21.727919, 20.727919, 19.727919, 18.727919,  17.727919, 16.72792,   15.72792,  14.727921,
      13.727921, 12.727921,  12.313707, 11.899494, 11.48528,  11.071067,  10.656854, 10.2426405, 9.828426,  9.414213,
      9.0,       9.0,        9.0,       9.0,       9.0,       9.0,        9.0,       9.0,        9.0,       9.0,
      9.0,       9.0,        9.0,       9.0,       9.0,       9.0,        9.0,       9.0,        9.0,       9.0,
      9.0,       9.0,        9.0,       9.414213,  9.828426,  10.2426405, 10.656854, 11.071067,  11.48528,
      11.899494, //
      23.313705, 22.313705,  21.313705, 20.313705, 19.313705, 18.313705,  17.313705, 16.313705,  15.313706, 14.313706,
      13.313707, 12.313707,  11.313707, 10.899494, 10.485281, 10.071067,  9.656854,  9.2426405,  8.828427,  8.414213,
      8.0,       8.0,        8.0,       8.0,       8.0,       8.0,        8.0,       8.0,        8.0,       8.0,
      8.0,       8.0,        8.0,       8.0,       8.0,       8.0,        8.0,       8.0,        8.0,       8.0,
      8.0,       8.0,        8.0,       8.414213,  8.828427,  9.2426405,  9.656854,  10.071067,  10.485281,
      10.899494, //
      22.899492, 21.899492,  20.899492, 19.899492, 18.899492, 17.899492,  16.899492, 15.899493,  14.899493, 13.899493,
      12.899493, 11.899494,  10.899494, 9.899494,  9.485281,  9.071068,   8.656854,  8.2426405,  7.8284273, 7.4142137,
      7.0,       7.0,        7.0,       7.0,       7.0,       7.0,        7.0,       7.0,        7.0,       7.0,
      7.0,       7.0,        7.0,       7.0,       7.0,       7.0,        7.0,       7.0,        7.0,       7.0,
      7.0,       7.0,        7.0,       7.4142137, 7.8284273, 8.2426405,  8.656854,  9.071068,   9.485281,
      9.899494, //
      22.48528,  21.48528,   20.48528,  19.48528,  18.48528,  17.48528,   16.48528,  15.485279,  14.48528,  13.48528,
      12.48528,  11.48528,   10.485281, 9.485281,  8.485281,  8.071068,   7.656854,  7.2426405,  6.8284273, 6.4142137,
      6.0,       6.0,        6.0,       6.0,       6.0,       6.0,        6.0,       6.0,        6.0,       6.0,
      6.0,       6.0,        6.0,       6.0,       6.0,       6.0,        6.0,       6.0,        6.0,       6.0,
      6.0,       6.0,        6.0,       6.4142137, 6.8284273, 7.2426405,  7.656854,  8.071068,   8.485281,
      9.485281, //
      22.071066, 21.071066,  20.071066, 19.071066, 18.071066, 17.071066,  16.071066, 15.071066,  14.071066, 13.071067,
      12.071067, 11.071067,  10.071067, 9.071068,  8.071068,  7.071068,   6.656854,  6.2426405,  5.8284273, 5.4142137,
      5.0,       5.0,        5.0,       5.0,       5.0,       5.0,        5.0,       5.0,        5.0,       5.0,
      5.0,       5.0,        5.0,       5.0,       5.0,       5.0,        5.0,       5.0,        5.0,       5.0,
      5.0,       5.0,        5.0,       5.4142137, 5.8284273, 6.2426405,  6.656854,  7.071068,   8.071068,
      9.071068, //
      21.656853, 20.656853,  19.656853, 18.656853, 17.656853, 16.656853,  15.656853, 14.656853,  13.656853, 12.656853,
      11.656854, 10.656854,  9.656854,  8.656854,  7.656854,  6.656854,   5.656854,  5.2426405,  4.8284273, 4.4142137,
      4.0,       4.0,        4.0,       4.0,       4.0,       4.0,        4.0,       4.0,        4.0,       4.0,
      4.0,       4.0,        4.0,       4.0,       4.0,       4.0,        4.0,       4.0,        4.0,       4.0,
      4.0,       4.0,        4.0,       4.4142137, 4.8284273, 5.2426405,  5.656854,  6.656854,   7.656854,
      8.656854, //
      21.24264,  20.24264,   19.24264,  18.24264,  17.24264,  16.24264,   15.24264,  14.24264,   13.24264,  12.24264,
      11.24264,  10.2426405, 9.2426405, 8.2426405, 7.2426405, 6.2426405,  5.2426405, 4.2426405,  3.828427,  3.4142137,
      3.0,       3.0,        3.0,       3.0,       3.0,       3.0,        3.0,       3.0,        3.0,       3.0,
      3.0,       3.0,        3.0,       3.0,       3.0,       3.0,        3.0,       3.0,        3.0,       3.0,
      3.0,       3.0,        3.0,       3.4142137, 3.828427,  4.2426405,  5.2426405, 6.2426405,  7.2426405,
      8.2426405, //
      20.828426, 19.828426,  18.828426, 17.828426, 16.828426, 15.828426,  14.828426, 13.828426,  12.828426, 11.828426,
      10.828426, 9.828426,   8.828427,  7.8284273, 6.8284273, 5.8284273,  4.8284273, 3.828427,   2.828427,  2.4142137,
      2.0,       2.0,        2.0,       2.0,       2.0,       2.0,        2.0,       2.0,        2.0,       2.0,
      2.0,       2.0,        2.0,       2.0,       2.0,       2.0,        2.0,       2.0,        2.0,       2.0,
      2.0,       2.0,        2.0,       2.4142137, 2.828427,  3.828427,   4.8284273, 5.8284273,  6.8284273,
      7.8284273, //
      20.414213, 19.414213,  18.414213, 17.414213, 16.414213, 15.414213,  14.414213, 13.414213,  12.414213, 11.414213,
      10.414213, 9.414213,   8.414213,  7.4142137, 6.4142137, 5.4142137,  4.4142137, 3.4142137,  2.4142137, 1.4142135,
      1.0,       1.0,        1.0,       1.0,       1.0,       1.0,        1.0,       1.0,        1.0,       1.0,
      1.0,       1.0,        1.0,       1.0,       1.0,       1.0,        1.0,       1.0,        1.0,       1.0,
      1.0,       1.0,        1.0,       1.4142135, 2.4142137, 3.4142137,  4.4142137, 5.4142137,  6.4142137,
      7.4142137, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.0,      19.0,       18.0,      17.0,      16.0,      15.0,       14.0,      13.0,       12.0,      11.0,
      10.0,      9.0,        8.0,       7.0,       6.0,       5.0,        4.0,       3.0,        2.0,       1.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       0.0,       0.0,       0.0,        0.0,       0.0,        0.0,       0.0,
      0.0,       0.0,        0.0,       1.0,       2.0,       3.0,        4.0,       5.0,        6.0,
      7.0, //
      20.414213, 19.414213,  18.414213, 17.414213, 16.414213, 15.414213,  14.414213, 13.414213,  12.414213, 11.414213,
      10.414213, 9.414213,   8.414213,  7.4142137, 6.4142137, 5.4142137,  4.4142137, 3.4142137,  2.4142137, 1.4142135,
      1.0,       1.0,        1.0,       1.0,       1.0,       1.0,        1.0,       1.0,        1.0,       1.0,
      1.0,       1.0,        1.0,       1.0,       1.0,       1.0,        1.0,       1.0,        1.0,       1.0,
      1.0,       1.0,        1.0,       1.4142135, 2.4142137, 3.4142137,  4.4142137, 5.4142137,  6.4142137,
      7.4142137, //
      20.828426, 19.828426,  18.828426, 17.828426, 16.828426, 15.828426,  14.828426, 13.828426,  12.828426, 11.828426,
      10.828426, 9.828426,   8.828427,  7.8284273, 6.8284273, 5.8284273,  4.8284273, 3.828427,   2.828427,  2.4142137,
      2.0,       2.0,        2.0,       2.0,       2.0,       2.0,        2.0,       2.0,        2.0,       2.0,
      2.0,       2.0,        2.0,       2.0,       2.0,       2.0,        2.0,       2.0,        2.0,       2.0,
      2.0,       2.0,        2.0,       2.4142137, 2.828427,  3.828427,   4.8284273, 5.8284273,  6.8284273,
      7.8284273, //
      21.24264,  20.24264,   19.24264,  18.24264,  17.24264,  16.24264,   15.24264,  14.24264,   13.24264,  12.24264,
      11.24264,  10.2426405, 9.2426405, 8.2426405, 7.2426405, 6.2426405,  5.2426405, 4.2426405,  3.828427,  3.4142137,
      3.0,       3.0,        3.0,       3.0,       3.0,       3.0,        3.0,       3.0,        3.0,       3.0,
      3.0,       3.0,        3.0,       3.0,       3.0,       3.0,        3.0,       3.0,        3.0,       3.0,
      3.0,       3.0,        3.0,       3.4142137, 3.828427,  4.2426405,  5.2426405, 6.2426405,  7.2426405,
      8.2426405, //
      21.656853, 20.656853,  19.656853, 18.656853, 17.656853, 16.656853,  15.656853, 14.656853,  13.656853, 12.656853,
      11.656854, 10.656854,  9.656854,  8.656854,  7.656854,  6.656854,   5.656854,  5.2426405,  4.8284273, 4.4142137,
      4.0,       4.0,        4.0,       4.0,       4.0,       4.0,        4.0,       4.0,        4.0,       4.0,
      4.0,       4.0,        4.0,       4.0,       4.0,       4.0,        4.0,       4.0,        4.0,       4.0,
      4.0,       4.0,        4.0,       4.4142137, 4.8284273, 5.2426405,  5.656854,  6.656854,   7.656854,
      8.656854, //
      22.071066, 21.071066,  20.071066, 19.071066, 18.071066, 17.071066,  16.071066, 15.071066,  14.071066, 13.071067,
      12.071067, 11.071067,  10.071067, 9.071068,  8.071068,  7.071068,   6.656854,  6.2426405,  5.8284273, 5.4142137,
      5.0,       5.0,        5.0,       5.0,       5.0,       5.0,        5.0,       5.0,        5.0,       5.0,
      5.0,       5.0,        5.0,       5.0,       5.0,       5.0,        5.0,       5.0,        5.0,       5.0,
      5.0,       5.0,        5.0,       5.4142137, 5.8284273, 6.2426405,  6.656854,  7.071068,   8.071068,
      9.071068, //
      22.48528,  21.48528,   20.48528,  19.48528,  18.48528,  17.48528,   16.48528,  15.485279,  14.48528,  13.48528,
      12.48528,  11.48528,   10.485281, 9.485281,  8.485281,  8.071068,   7.656854,  7.2426405,  6.8284273, 6.4142137,
      6.0,       6.0,        6.0,       6.0,       6.0,       6.0,        6.0,       6.0,        6.0,       6.0,
      6.0,       6.0,        6.0,       6.0,       6.0,       6.0,        6.0,       6.0,        6.0,       6.0,
      6.0,       6.0,        6.0,       6.4142137, 6.8284273, 7.2426405,  7.656854,  8.071068,   8.485281,
      9.485281, //
      22.899492, 21.899492,  20.899492, 19.899492, 18.899492, 17.899492,  16.899492, 15.899493,  14.899493, 13.899493,
      12.899493, 11.899494,  10.899494, 9.899494,  9.485281,  9.071068,   8.656854,  8.2426405,  7.8284273, 7.4142137,
      7.0,       7.0,        7.0,       7.0,       7.0,       7.0,        7.0,       7.0,        7.0,       7.0,
      7.0,       7.0,        7.0,       7.0,       7.0,       7.0,        7.0,       7.0,        7.0,       7.0,
      7.0,       7.0,        7.0,       7.4142137, 7.8284273, 8.2426405,  8.656854,  9.071068,   9.485281,
      9.899494, //
      23.313705, 22.313705,  21.313705, 20.313705, 19.313705, 18.313705,  17.313705, 16.313705,  15.313706, 14.313706,
      13.313707, 12.313707,  11.313707, 10.899494, 10.485281, 10.071067,  9.656854,  9.2426405,  8.828427,  8.414213,
      8.0,       8.0,        8.0,       8.0,       8.0,       8.0,        8.0,       8.0,        8.0,       8.0,
      8.0,       8.0,        8.0,       8.0,       8.0,       8.0,        8.0,       8.0,        8.0,       8.0,
      8.0,       8.0,        8.0,       8.414213,  8.828427,  9.2426405,  9.656854,  10.071067,  10.485281,
      10.899494, //
      23.727919, 22.727919,  21.727919, 20.727919, 19.727919, 18.727919,  17.727919, 16.72792,   15.72792,  14.727921,
      13.727921, 12.727921,  12.313707, 11.899494, 11.48528,  11.071067,  10.656854, 10.2426405, 9.828426,  9.414213,
      9.0,       9.0,        9.0,       9.0,       9.0,       9.0,        9.0,       9.0,        9.0,       9.0,
      9.0,       9.0,        9.0,       9.0,       9.0,       9.0,        9.0,       9.0,        9.0,       9.0,
      9.0,       9.0,        9.0,       9.414213,  9.828426,  10.2426405, 10.656854, 11.071067,  11.48528,
      11.899494, //
      24.142132, 23.142132,  22.142132, 21.142132, 20.142132, 19.142132,  18.142134, 17.142134,  16.142134, 15.142134,
      14.142134, 13.727921,  13.313707, 12.899493, 12.48528,  12.071067,  11.656854, 11.24264,   10.828426, 10.414213,
      10.0,      10.0,       10.0,      10.0,      10.0,      10.0,       10.0,      10.0,       10.0,      10.0,
      10.0,      10.0,       10.0,      10.0,      10.0,      10.0,       10.0,      10.0,       10.0,      10.0,
      10.0,      10.0,       10.0,      10.414213, 10.828426, 11.24264,   11.656854, 12.071067,  12.48528,
      12.899493 //
  };

  std::uint8_t mask_data[] = {
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, //
  };

  std::uint8_t img_data[WIDTH * HEIGHT];
  std::memset(img_data, 0, WIDTH * HEIGHT);

  dt::image2d_view img(img_data, WIDTH, HEIGHT, WIDTH);
  dt::image2d_view mask(mask_data, WIDTH, HEIGHT, WIDTH);
  dt::image2d_view ref_dist(ref_data, WIDTH, HEIGHT, WIDTH);

  auto       d_img  = dt::host_to_device(img);
  auto       d_mask = dt::host_to_device(mask);
  const auto d_dist = dt::geodesic_distance_transform(d_img, d_mask, 1e10, 0, 1, 100);
  const auto dist   = dt::device_to_host(d_dist);

  ASSERT_IMAGES_EQ(dist, ref_dist);
}